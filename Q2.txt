
# 券商私有化方案（参考中信的模拟交易项目，后面只要接口对接上实盘）
1. 参考中信安全，项目独立化，交易数据管理（数据存储和访问）服务，中信未实现的：a)实盘账户管理（现在是去申请模拟账号），b)更友好的服务管理端，c)订阅别人的策略的实盘交易是否需要，d)系统可靠性与监控
2. oms系统，接收报单（主要来自于计划下单），接收回报（预处理和过滤等），算法交易及一些买卖规则（如涨停不卖出，跌停不买入）等功能，可定制化订单执行逻辑（高级功能）
3. 交易接口抽象，由oms使用，便于对接不同券商的不同接口
4. 风控模块（仓位控制，股票池/板块黑名单，止盈止损条件等）
5. 统一的服务调度运行：运行策略，运行OMS，运行清算

# 券商半私有化方案（除了模型训练及交易信号来自于BigQuant，其它模块均托管运行在券商，即券商依赖于BigQuant的数据源）
1. 其它回测、模拟、实盘打包运行，
2. 实盘账户与策略绑定，风控配置等，然后由我们每日统一调度运行oms，主要以算法单执行
3. 风险：实现实盘交易模式的风险需要充分告知，系统的可靠性（故障恢复/容错，系统监控告警）


# 实盘交易终端化（运行在投资者端）
1. 提供一个可（半）自动化股票交易终端，交易信号来处于BigQuant，交易执行由oms管理执行（需要对接各个券商的接口），风控配置，可人工干预调整买卖的执行
2. 每日盘后同步实盘数据（资金、持仓、订单）到BigQuant，便于查看实盘资金曲线和策略分析


# 其它
1. 性能优化
2. tick回测
3. 实时行情模块
4. 线上模拟交易改造（参考中信模拟交易案例）


######################################################################
当前中信案例时的项目改造：
1. 数据存储与访问服务，比现有db_service更高级，功能更丰富（写入/查询），有更安全的检验
2. OMS系统
3. 对内统一的交易接口及数据结构
4. 实盘可根据盘口撮合的撮合引擎，并提供接口，便于后续线上模拟交易改造以及其它系统测试，需要有实时行情支持
5. 测试用例

回测->模拟->实盘交易（系统尽量参数化，用户只需要调整参数即可）：
（数据库需要有初始化系统的记录，系统版本信息、每日日终清算对账记录及标志等）
以友好的管理界面，包括对策略管理，策略信息查看，交易信号调整，风控参数调整，买卖策略的调整等。

一、策略：
1. 策略基本信息：策略ID、来源（自有/订阅）、策略开始时间、累计收益、当日收益、最大回撤、初始资金、Sharpe值、当前资产/仓位，信号时间等
2. 是否跟踪该策略，以模拟或实盘方式，申请时需要提交交易账号信息，配置风控，选择OMS执行策略（除账号信息，其它均可以后续调整）
3. 实盘交易时，可更换跟踪的策略，但要注意当前已有的仓位的轮换 
4. 策略每日需要接收模拟/实盘交易后的资金/持仓/交易记录，也便于查看资金曲线和策略分析
5. 注意实盘与模拟盘资金不匹配时，或策略下单仓位总是过高时，实盘下如何自动调整到可接收数量，如按风控最大上限上限调整等


二、风控（多级风控）：
1. 个股止损比例
2. 个股最大仓位
3. 账户最大仓位
4. 股票池子/板块
5. 每日最多买入n支股票
6. 下单频率，撤单次数等

三、OMS执行时的买入/卖出策略（买卖时机，算法交易，人工干预，高级功能等）：
1. 集合竞价买入/卖出，限价/涨跌停价
2. 连续交易买入/卖出，限价/市价（五档即成剩撤）
3. 算法交易：TWAP/VWAP，配置算法单参数：开始截止时间，参与度等
4. 一些买卖条件：
    4.1 涨停不卖出，跌停不买入，或者按涨幅幅度决定是否买入/卖出（每支股票都有是否需要交易的状态）
    4.2 黑名单的不买入
    4.3 卖出策略，便于控制风险，如跌破某均价值，日线均价拐头向下，全市场跌停数量达到某值，全市场下跌股票数达到某值，换手率达到70%，成交量放量指标等条件
5. 可人工干预（主要是交易执行前）
    5.1 一键暂停买入/卖出（如停牌或一些突发黑天鹅事件）
    5.2 调整数量或买卖条件
6. 高级功能，类似于程序化交易终端，用户可自定义买卖执行（以参数方式调整策略执行/以代码方式执行），如计划买入的股票涨停，可买入同板块的候选股票，或该股票在当日突破某指标时才买入/卖出
7. 其它，如因为某些原因，原设定为在集合竞价买入的策略未成功，是否在连续交易期间继续买入（默认为是，也可走人工干预途径）
8. 服务端的OMS安全认证，只允许特定部分用户通过OMS

四、实时行情依赖

五、服务可靠性与监控：
1. 日志持久化
2. 服务可自动恢复
3. 对各服务监控，及时告警（邮件/微信推送等）
    3.1 策略运行
    3.2 OMS执行：计划交易获取异常，执行逻辑异常，业务超时等
    3.3 日终对账时的异常
4. 各用户可及时查看自己策略执行/交易执行时的异常日志/关键信息等，尽量及早发现问题

六、模拟撮合引擎服务
  核心撮合模块一致（主要是根据tick行情撮合，股票有T+1），但外部驱动方式有区别，服务运行模式也有区别
1. 回测模式
    1.1 行情来自于历史行情（外部输入/从DataSource加载），可使用一个行情引擎负责向核心撮合模拟播放行情，注意交易日的切换
    1.2 数据无状态（不持久化）
    1.3 服务作为模块随回测运行时加载
2. 实盘模拟模式
    2.1 行情来自于实时行情接口
    2.2 以Service方式对外提供服务，交易期间需要对数据进行持久化
    2.3 服务启动时，需要初始化，加载系统中的账户数据：资金、持仓，更新交易日等，并有系统初始化标志（当前中信为每个策略运行时初始化）
    2.4 仍然有登录、查询接口，主动推送数据等功能
    2.5 定时运行，提供服务的时间段可参考实盘（期货有夜盘）
3. 接口（统一的接口形式及数据结构）：
    3.1 回测时，接口内部直接调用撮合引擎相关功能接口
    3.2 实盘模拟时，以网络方式请求撮合引擎前置
4. 服务监控，出错/当前系统撮合情况/性能指标等（实盘模拟时）
5. 撮合错误时，可人工干预修改（便于日终清算数据对账，否则数据过于离谱）

七、日终清算对账
运行模式与现有相同，根据清算数据，检验本地账户数据，包括资金、持仓、交易流水，得出绩效数据。
1. 清算数据，中信来自于ods，其它可能需要接口查询/可清算文件，而模拟交易时，可访问模拟撮合引擎的数据库
2. 清算出错时，有告警，否则不可以进行下一日的策略运行
3. 清算成功后，有清算结束标志

八、交易分析：
1. 策略资金曲线，历史交易记录，持仓情况
2. 实盘数据，实盘交易可能在不同时间段来自于不同的策略信号，记录每支股票的交易来源/每个策略交易了哪些股票，各收益如何等

